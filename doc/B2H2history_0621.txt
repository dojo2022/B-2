--[ユーザマスタ]
--{テーブルの作成}
CREATE TABLE Users (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
user_id CHAR(5) ,
username VARCHAR (30)  NOT NULL UNIQUE,
password VARCHAR (30) NOT NULL,
mail VARCHAR (100)
);
--{データの登録}
INSERT INTO Users (username,password,mail) VALUES ('ヤマダタロウ','pass','@gmail.com');
UPDATE Users SET  user_id=(SELECT CONCAT('u',id) FROM Users WHERE user_id IS NULL) WHERE user_id IS NULL;

INSERT INTO Users (username,password,mail) VALUES ('植田','pass','');
UPDATE Users SET  user_id=(SELECT CONCAT('u',id) FROM Users WHERE user_id IS NULL) WHERE user_id IS NULL;

INSERT INTO Users (username,password,mail) VALUES ('清水','pass','');
UPDATE Users SET  user_id=(SELECT CONCAT('u',id) FROM Users WHERE user_id IS NULL) WHERE user_id IS NULL;

---------------------------------
--[資格マスタ]
--{テーブルの作成}
CREATE TABLE Certifications (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
certification_id CHAR(5) ,
certification VARCHAR(30)  NOT NULL UNIQUE,
category VARCHAR (10) NOT NULL,
book_name VARCHAR (50),
book_image VARCHAR (30),
level CHAR (1)
);

--{データの登録}
INSERT INTO Certifications (certification,category,book_name,book_image,level) VALUES ('ITパスポート','allit','イメージ＆クレバー方式でよくわかる栢木先生のITパスポート教室','WebContents/img/img0003.png','2');
UPDATE Certifications SET  certification_id=(SELECT CONCAT('a',id) FROM Certifications WHERE certification_id IS NULL) WHERE certification_id IS NULL;

INSERT INTO Certifications (certification,category,book_name,book_image,level) VALUES ('基本情報技術者試験','allit','よくわかる！FE','WebContents/img/img0001.png','3');
UPDATE Certifications SET  certification_id=(SELECT CONCAT('a',id) FROM Certifications WHERE certification_id IS NULL) WHERE certification_id IS NULL;

INSERT INTO Certifications (certification,category,book_name,book_image,level) VALUES ('応用情報技術者試験','allit','よくわかる！AP','WebContents/img/img0002.png','4');
UPDATE Certifications SET  certification_id=(SELECT CONCAT('a',id) FROM Certifications WHERE certification_id IS NULL) WHERE certification_id IS NULL;

---------------------------------
--[項目マスタ]
--{テーブルの作成}
CREATE TABLE Items (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
certification_id CHAR(5) NOT NULL,
FOREIGN KEY(certification_id) REFERENCES Certifications (certification_id ),
item_id CHAR(5) ,
item VARCHAR (30)  NOT NULL,
item_page INT (3) NOT NULL
);
--{データの登録}
INSERT INTO Items (certification_id,item,item_page) VALUES ('a1','アルゴリズムとプログラミング','50');
UPDATE Items SET item_id=(SELECT CONCAT('b',id) FROM Items WHERE item_id IS NULL) WHERE item_id IS NULL;

INSERT INTO Items (certification_id,item,item_page) VALUES ('a1','データベース','30');
UPDATE Items SET item_id=(SELECT CONCAT('b',id) FROM Items WHERE item_id IS NULL) WHERE item_id IS NULL;

INSERT INTO Items (certification_id,item,item_page) VALUES ('a1','ネットワーク','20');
UPDATE Items SET item_id=(SELECT CONCAT('b',id) FROM Items WHERE item_id IS NULL) WHERE item_id IS NULL;

INSERT INTO Items (certification_id,item,item_page) VALUES ('a1','セキュリティ','30');
UPDATE Items SET item_id=(SELECT CONCAT('b',id) FROM Items WHERE item_id IS NULL) WHERE item_id IS NULL;

---------------------------------
--[試験日マスタ]
--{テーブルの作成}
CREATE TABLE Test_days (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
certification_id CHAR(5) NOT NULL,
FOREIGN KEY(certification_id) REFERENCES Certifications (certification_id ),
testdays CHAR(10) NOT NULL,
app_start CHAR(10),
app_fin CHAR(10)
);
--{データの登録}
INSERT INTO Test_days (certification_id,testdays,app_start,app_fin) VALUES ('a1','2022/10/01','','');
INSERT INTO Test_days (certification_id,testdays,app_start,app_fin) VALUES ('a1','2023/04/01','','');
INSERT INTO Test_days (certification_id,testdays,app_start,app_fin) VALUES ('a2','2022/10/01','','');
--{資格名と試験日程の検索}
SELECT Certifications.certification, Test_days.testdays FROM Certifications, Test_days WHERE  Certifications .certification_id =Test_days .certification_id ;
SELECT TEST_DAYS .certification_id, TEST_DAYS .testdays FROM CERTIFICATIONS ,Test_days WHERE  Certifications .certification_id =Test_days .certification_id AND CERTIFICATIONS .CERTIFICATION LIKE ? ORDER BY testdays;
*/
---------------------------------
--[My資格トランザクション]
--{テーブルの作成}
CREATE TABLE My_certifications (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
user_id CHAR(5) NOT NULL,
FOREIGN KEY(user_id) REFERENCES Users (user_id),
certification_id CHAR(5) NOT NULL,
FOREIGN KEY(certification_id) REFERENCES Certifications (certification_id),
testdays CHAR(10) NOT NULL
);

--{データの登録}
INSERT INTO My_certifications (user_id,certification_id,testdays) VALUES ('u1','a1','2022/10/01');
INSERT INTO My_certifications (user_id,certification_id,testdays) VALUES ('u1','a2','2023/04/01');
INSERT INTO My_certifications (user_id,certification_id,testdays) VALUES ('u2','a1','2022/10/01');
INSERT INTO My_certifications (user_id,certification_id,testdays) VALUES ('u2','a3','2023/10/01');
---------------------------------
--[目標マスタ]
--{テーブルの作成}
CREATE TABLE Targets (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
target_id CHAR(5) ,
item_id CHAR(5) NOT NULL,
FOREIGN KEY(item_id) REFERENCES Items (item_id ),
target VARCHAR (40)  NOT NULL
);
--{データの登録}
INSERT INTO Targets (item_id,target) VALUES ('b1','バブルソートがわかる');
UPDATE Targets SET target_id=(SELECT CONCAT('c',id) FROM Targets WHERE target_id IS NULL) WHERE target_id IS NULL;

INSERT INTO Targets (item_id,target) VALUES ('b1','二分探索法がわかる');
UPDATE Targets SET target_id=(SELECT CONCAT('c',id) FROM Targets WHERE target_id IS NULL) WHERE target_id IS NULL;

---------------------------------
--[目標理解度トランザクション]
--{テーブルの作成}
CREATE TABLE Target_understands (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
target_id CHAR(5) NOT NULL,
FOREIGN KEY(target_id) REFERENCES Targets (target_id ),
item_id CHAR(5) NOT NULL,
FOREIGN KEY(item_id) REFERENCES Items (item_id ),
user_id CHAR(5) NOT NULL,
FOREIGN KEY(user_id) REFERENCES Users (user_id ),
day CHAR(10) ,
target_understand CHAR(1) DEFAULT 0
);
--{データの登録}
INSERT INTO Target_understands (target_id,item_id,user_id) VALUES ('c1','b1','u1');
INSERT INTO Target_understands (target_id,item_id,user_id) VALUES ('c2','b1','u1');
---------------------------------
--[本日の目標トランザクション]
--{テーブルの作成}
CREATE TABLE Today_targets (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
user_id CHAR(5) NOT NULL,
FOREIGN KEY(user_id) REFERENCES Users (user_id ),
item_id CHAR(5) NOT NULL,
FOREIGN KEY(item_id) REFERENCES Items (item_id ),
today_target CHAR(1) DEFAULT 0
);
--{データの登録}
INSERT INTO Today_targets (user_id,item_id,today_target) VALUES ('u1','b1','2');
INSERT INTO Today_targets (user_id,item_id,today_target) VALUES ('u1','b2','1');
INSERT INTO Today_targets (user_id,item_id,today_target) VALUES ('u1','b3','1');
INSERT INTO Today_targets (user_id,item_id,today_target) VALUES ('u1','b4','0');
---------------------------------
--[スレッドマスタ]
--{テーブルの作成}
CREATE TABLE Threads (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
thread_id CHAR(5),
thread_bbs VARCHAR (30) NOT NULL UNIQUE,
category_bbs VARCHAR (10) NOT NULL
);
--{データの登録}
INSERT INTO Threads (thread_bbs,category_bbs) VALUES ('基本情報技術者試験','exam');
UPDATE Threads SET thread_id=(SELECT CONCAT('x',id) FROM Threads WHERE thread_id IS NULL) WHERE thread_id IS NULL;

INSERT INTO Threads (thread_bbs,category_bbs) VALUES ('応用情報技術者試験','exam');
UPDATE Threads SET thread_id=(SELECT CONCAT('x',id) FROM Threads WHERE thread_id IS NULL) WHERE thread_id IS NULL;

INSERT INTO Threads (thread_bbs,category_bbs) VALUES ('IT就活生の会','chat');
UPDATE Threads SET thread_id=(SELECT CONCAT('x',id) FROM Threads WHERE thread_id IS NULL) WHERE thread_id IS NULL;

INSERT INTO Threads (thread_bbs,category_bbs) VALUES ('非IT企業ユーザーの会','chat');
UPDATE Threads SET thread_id=(SELECT CONCAT('x',id) FROM Threads WHERE thread_id IS NULL) WHERE thread_id IS NULL;

---------------------------------
--[コメントトランザクション]
--{テーブルの作成}//作業途中
CREATE TABLE Comments (
id INT (4) PRIMARY KEY AUTO_INCREMENT,
thread_id CHAR(5) NOT NULL,
FOREIGN KEY(thread_id) REFERENCES Threads (thread_id ),
comment_id CHAR(5),
user_id CHAR(5) NOT NULL,
FOREIGN KEY(user_id) REFERENCES Users (user_id ),
content_bbs VARCHAR (200),
time_bbs DATETIME
);
--{データの登録}
INSERT INTO Comments (thread_id,user_id,content_bbs,time_bbs) VALUES ('x1','u1','アルゴリズム全くわからん',now());
UPDATE Comments SET comment_id=(SELECT CONCAT('y',id) FROM Comments WHERE comment_id IS NULL) WHERE comment_id IS NULL;

INSERT INTO Comments (thread_id,user_id,content_bbs,time_bbs) VALUES ('x1','u2','過去問？○○って参考書がおすすめだよ',now());
UPDATE Comments SET comment_id=(SELECT CONCAT('y',id) FROM Comments WHERE comment_id IS NULL) WHERE comment_id IS NULL;

---------------------------------
---------------------------------
/*
[もしも「u0001」が使いたくなったら]
UPDATE Users SET  user_id =(SELECT concat('u',right(concat('0000',CAST( (SELECT id FROM USERS where user_id is null) AS CHAR)),4) )from users where user_id is null ) where user_id is null;
[テーブルの削除]
DROP TABLE IF EXISTS Users;

[My資格トランザクション　入れるとバグるかも]
testdays CHAR(10) NOT NULL,
FOREIGN KEY(testdays) REFERENCES Test_days(testdays)

{データの登録}
INSERT INTO My_certifications (user_id,certification_id,item_id,testdays) VALUES ('u1','a1','b1','2022-10-01');
INSERT INTO My_certifications (user_id,certification_id,item_id,testdays) VALUES ('u1','a1','b2','2022-10-01');
INSERT INTO My_certifications (user_id,certification_id,item_id,testdays) VALUES ('u1','a1','b3','2022-10-01');
INSERT INTO My_certifications (user_id,certification_id,item_id,testdays) VALUES ('u1','a1','b4','2022-10-01');
*/